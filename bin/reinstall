#!/bin/bash

BIN_DIR=`dirname $0`

# check running from docroot
CURRENT_DIR=${PWD##*/}
if [ ! "$CURRENT_DIR" = "docroot" ]; then
  echo 'Please be sure that you are running this command from the docroot.'
  exit 2
fi

# Set the backup name
source $BIN_DIR/set-backup-name

# make a backup of current db
drush sql-dump -l default --gzip --result-file=../db/backups/$BACKUP_NAME

# delete the tmp files
rm ../tmp/devel-mails/* 2>/dev/null

chmod -R a+rwx sites/default/settings.php

drush -y -l default site-install ilr --site-name="ILR Dev Site | Cornell University" --clean-url=1 --account-pass=testing --account-mail=aaronf@cornell.edu

# enable some useful development modules
drush -y -l default en drupal_streamline_dev ilr_dev

# open the login page
open -a /Applications/firefox.app "http://www.ilr-website.dev/user/login"
