<?php
/**
 * @file
 * Code for the ILR Paragraphs feature.
 */

include_once 'ilr_paragraphs.features.inc';

/**
 * Implements hook_preprocess_field().
 *
 */
function ilr_paragraphs_preprocess_field(&$variables) {
  _ilr_paragraphs_add_class_to_item_field($variables, 'sponsor_message', 'field_comments', 'centered-blurb');
  _ilr_paragraphs_add_class_to_item_field($variables, 'sponsor_message', 'field_comments', 'tower', 'field_title_icon_none', 'Icon');
  _ilr_paragraphs_link_person_to_profile($variables);
}

/**
 * If $cond_field is unspecified or if pragraphs_item['{$paragraphs_bundle}']['{$cond_field}'] == $cond_value
 * then add a class $value to pragraphs_item['{$paragraphs_bundle}']['{$field}']
 */
function _ilr_paragraphs_add_class_to_item_field(&$variables, $paragraphs_bundle, $field, $value, $cond_field = '', $cond_value = '') {
  if (
    $variables['element']['#field_name'] == $field &&
    $variables['element']['#bundle'] == $paragraphs_bundle
  ) {
    if ($cond_field == '' ||
      $variables['element']['#object']->{$cond_field}['und'][0]['value'] == $cond_value
    ) {
      $variables['classes_array'][] = $value;
      $variables['attr'] = drupal_attributes(array(
        'class' => $variables['classes_array'],
      ));
    }
  }
}

/**
 * Links people in field_people_list's to their profile page.
 */
function _ilr_paragraphs_link_person_to_profile(&$variables) {
  if (
    $variables['element']['#bundle'] == 'field_people_list' &&
    $variables['element']['#field_name'] == 'field_full_name'
  ) {
    $net_id = $variables['element']['#object']->field_netid['und'][0]['value'];
    if ($net_id != '') {
      $full_name = $variables['element']['#object']->field_full_name['und'][0]['value'];
      $markup = '<a href="/directory'.$net_id.'">'.$full_name.'</a>';
      $variables['items'][0]['#markup'] = $markup;
    }
  }
}
